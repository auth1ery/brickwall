!function(){var s=document.currentScript||(function(){var e=document.getElementsByTagName("script");return e[e.length-1]})(),k=s.getAttribute("data-site"),a=s.getAttribute("data-api")||"https://brickwall.onrender.com",c=s.getAttribute("data-challenge")||"https://brickwall.onrender.com";if(k){var sk="bw_token_"+k;function gt(){try{return localStorage.getItem(sk)}catch(e){return null}}function ct(){try{localStorage.removeItem(sk)}catch(e){}}function dx(t){try{var p=t.split(".");if(p.length!==3)return null;var d=JSON.parse(atob(p[1].replace(/-/g,"+").replace(/_/g,"/")));return d.exp||null}catch(e){return null}}function fi(t){var x=dx(t);return!!x&&(x-60)>Date.now()/1e3}function su(){try{var u=new URL(window.location.href),t=u.searchParams.get("bw_token");if(!t)return;u.searchParams.delete("bw_token");try{localStorage.setItem(sk,t)}catch(e){}if(window.history&&window.history.replaceState)window.history.replaceState(null,"",u.toString())}catch(e){}}function rd(){window.location.replace(c+"/challenge.html?k="+encodeURIComponent(k)+"&r="+encodeURIComponent(window.location.href))}function vf(t,cb){var x=new XMLHttpRequest;x.open("POST",a+"/api/challenge/check",true);x.setRequestHeader("Content-Type","application/json");x.timeout=5e3;x.onreadystatechange=function(){if(x.readyState!==4)return;try{var d=JSON.parse(x.responseText);cb(d.valid===true)}catch(e){cb(false)}};x.ontimeout=x.onerror=function(){cb(true)};x.send(JSON.stringify({token:t,siteKey:k}))}function run(){su();var t=gt();if(!t){rd();return}if(!fi(t)){ct();rd();return}vf(t,function(v){if(!v){ct();rd()}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",run):run()}};
